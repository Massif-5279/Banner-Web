<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒå±‚è½®æ’­å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            overflow: hidden;
            background: #000;
        }

        .carousel-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* èƒŒæ™¯è½®æ’­å›¾ - æ¨¡ç³Šæ•ˆæœï¼Œå®Œå…¨å¡«æ»¡å±å¹• */
        .background-carousel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .background-carousel img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* å®Œå…¨å¡«æ»¡å±å¹•ï¼Œä¸ä¿æŒæ¯”ä¾‹ */
            /* æ¨¡ç³Šæ•ˆæœ - æ·»åŠ æµè§ˆå™¨å‰ç¼€æ”¯æŒ */
            -webkit-filter: blur(20px);
            -moz-filter: blur(20px);
            -ms-filter: blur(20px);
            filter: blur(20px);
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        /* è€æµè§ˆå™¨é™çº§æ–¹æ¡ˆ - æ·»åŠ åŠé€æ˜é®ç½©å±‚ */
        .background-carousel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
            pointer-events: none;
        }

        .background-carousel img.active {
            opacity: 0.7; /* èƒŒæ™¯å›¾ç‰‡é€æ˜åº¦ */
        }

        /* ä¸»è½®æ’­å›¾ - ä¿æŒæ¯”ä¾‹ï¼Œå¡«æ»¡å±å¹• */
        .main-carousel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3; /* ç¡®ä¿åœ¨é®ç½©å±‚ä¹‹ä¸Š */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-carousel img {
            position: absolute;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* ä¿æŒåŸå§‹æ¯”ä¾‹ */
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .main-carousel img.active {
            opacity: 1;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            color: white;
            backdrop-filter: blur(10px);
            display: none; /* éšè—æ§åˆ¶é¢æ¿ */
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .control-group input[type="range"] {
            width: 200px;
            margin-right: 10px;
        }

        .control-group input[type="number"] {
            width: 80px;
            padding: 5px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-align: center;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* æŒ‡ç¤ºå™¨ */
        .indicators {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: none; /* éšè—æŒ‡ç¤ºå™¨ */
            gap: 10px;
        }

        .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background 0.3s;
        }

        .indicator.active {
            background: white;
        }

        /* å¯¼èˆªç®­å¤´ */
        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: background 0.3s;
            display: none; /* éšè—å¯¼èˆªç®­å¤´ */
        }

        .nav-arrow:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .nav-arrow.prev {
            left: 20px;
        }

        .nav-arrow.next {
            right: 20px;
        }

        /* çŠ¶æ€æ˜¾ç¤º */
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 5px;
            color: white;
            font-size: 14px;
            display: none; /* éšè—çŠ¶æ€æ˜¾ç¤º */
        }
    </style>
</head>
<body>
    <div class="carousel-container">
        <!-- èƒŒæ™¯è½®æ’­å›¾ -->
        <div class="background-carousel" id="backgroundCarousel">
            <!-- å›¾ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </div>

        <!-- ä¸»è½®æ’­å›¾ -->
        <div class="main-carousel" id="mainCarousel">
            <!-- å›¾ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </div>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="controls">
        <div class="control-group">
            <label>åˆ‡æ¢é—´éš” (ç§’)</label>
            <input type="range" id="intervalSlider" min="1" max="10" value="3" step="0.5">
            <input type="number" id="intervalInput" min="1" max="10" value="3" step="0.5">
        </div>
        <div class="control-buttons">
            <button class="btn" id="playPauseBtn">æš‚åœ</button>
            <button class="btn" id="prevBtn">ä¸Šä¸€å¼ </button>
            <button class="btn" id="nextBtn">ä¸‹ä¸€å¼ </button>
        </div>
    </div>

    <!-- æŒ‡ç¤ºå™¨ -->
    <div class="indicators" id="indicators">
        <!-- æŒ‡ç¤ºå™¨å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
    </div>

    <!-- å¯¼èˆªç®­å¤´ -->
    <button class="nav-arrow prev" id="navPrev">â€¹</button>
    <button class="nav-arrow next" id="navNext">â€º</button>

    <!-- çŠ¶æ€æ˜¾ç¤º -->
    <div class="status" id="status">
        æ­£åœ¨åŠ è½½å›¾ç‰‡...
    </div>

    <!-- åŠ è½½æç¤º -->
    <div class="loading-overlay" id="loadingOverlay" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        color: white;
        font-size: 18px;
        backdrop-filter: blur(10px);
    ">
        <div style="text-align: center;">
            <div style="margin-bottom: 20px;">æ­£åœ¨åŠ è½½å›¾ç‰‡...</div>
            <div id="loadingProgress">0/110</div>
        </div>
    </div>

    <script>
        class DualCarousel {
            constructor() {
                // å›¾ç‰‡æ•°ç»„å°†é€šè¿‡è‡ªåŠ¨æ£€æµ‹å¡«å……
                this.images = [];
                this.currentIndex = 0;
                this.interval = 6000; // é»˜è®¤3ç§’
                this.isPlaying = true;
                this.timer = null;
                this.loadedImages = 0;
                this.totalImages = 0; // å°†åœ¨è‡ªåŠ¨æ£€æµ‹åæ›´æ–°
                
                // æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒCSS filter
                this.supportsFilter = this.checkFilterSupport();
                this.enhanceCompatibility();
                
                this.init();
            }

            // æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒCSS filter
            checkFilterSupport() {
                var testElement = document.createElement('div');
                testElement.style.cssText = '-webkit-filter: blur(2px); filter: blur(2px);';
                return testElement.style.filter !== '' || testElement.style.webkitFilter !== '';
            }

            // å¢å¼ºè€æµè§ˆå™¨å…¼å®¹æ€§
            enhanceCompatibility() {
                if (!this.supportsFilter) {
                    // å¦‚æœä¸æ”¯æŒfilterï¼Œå¢å¼ºé®ç½©å±‚æ•ˆæœ
                    var style = document.createElement('style');
                    style.textContent = 
                        '.background-carousel::after { background: rgba(0, 0, 0, 0.5) !important; }' +
                        '.background-carousel img { transform: scale(1.1); }'; // è½»å¾®æ”¾å¤§æ¨¡æ‹Ÿæ¨¡ç³Š
                    document.head.appendChild(style);
                    console.log('è€æµè§ˆå™¨å…¼å®¹æ¨¡å¼ï¼šä½¿ç”¨é®ç½©å±‚æ›¿ä»£æ¨¡ç³Šæ•ˆæœ');
                }
            }

            init() {
                var self = this;
                // é¦–å…ˆè‡ªåŠ¨æ£€æµ‹å›¾ç‰‡æ•°é‡
                this.autoDetectImages().then(function() {
                    // æ£€æµ‹å®Œæˆåå¼€å§‹é¢„åŠ è½½
                    return self.preloadImages();
                }).then(function() {
                    self.createImages();
                    self.createIndicators();
                    self.bindEvents();
                    self.startAutoPlay();
                    self.updateStatus();
                });
            }

            // è‡ªåŠ¨æ£€æµ‹å›¾ç‰‡æ•°é‡
            autoDetectImages() {
                var self = this;
                var localBaseUrl = './static/';
                
                return new Promise(function(resolve) {
                    console.log('å¼€å§‹è‡ªåŠ¨æ£€æµ‹æœ¬åœ°å›¾ç‰‡æ•°é‡...');
                    
                    // æ›´æ–°åŠ è½½çŠ¶æ€æ˜¾ç¤º
                    var loadingProgress = document.getElementById('loadingProgress');
                    if (loadingProgress) {
                        loadingProgress.textContent = 'æ£€æµ‹æœ¬åœ°å›¾ç‰‡ä¸­...';
                    }
                    
                    // ç›´æ¥ä½¿ç”¨æœ¬åœ°å›¾ç‰‡æºè¿›è¡Œæ£€æµ‹
                    self.detectImagesSequentially(localBaseUrl, 1, []).then(function(imageUrls) {
                        self.images = imageUrls;
                        self.totalImages = self.images.length;
                        
                        console.log('æœ¬åœ°å›¾ç‰‡æ£€æµ‹å®Œæˆï¼Œæ‰¾åˆ° ' + self.totalImages + ' å¼ å›¾ç‰‡');
                        console.log('å›¾ç‰‡èŒƒå›´ï¼š1.jpg åˆ° ' + self.totalImages + '.jpg');
                        
                        // æ›´æ–°åŠ è½½çŠ¶æ€
                        if (loadingProgress) {
                            loadingProgress.textContent = '0/' + self.totalImages;
                        }
                        
                        resolve();
                    });
                });
            }



            // é€’å¢æ£€æµ‹å›¾ç‰‡ï¼Œé‡åˆ°è¿ç»­å¤±è´¥åˆ™åœæ­¢
            detectImagesSequentially(baseUrl, startIndex, foundImages) {
                var self = this;
                var consecutiveFailures = 0;
                var maxConsecutiveFailures = 10; // è¿ç»­å¤±è´¥10æ¬¡ååœæ­¢æ£€æµ‹
                
                return new Promise(function(resolve) {
                    function checkNext(index) {
                        var url = baseUrl + index + '.jpg';
                        
                        self.checkImageExists(url, index).then(function(result) {
                            if (result.exists) {
                                foundImages.push(result.url);
                                consecutiveFailures = 0; // é‡ç½®å¤±è´¥è®¡æ•°
                                
                                // æ›´æ–°æ£€æµ‹è¿›åº¦
                                var loadingProgress = document.getElementById('loadingProgress');
                                if (loadingProgress) {
                                    loadingProgress.textContent = 'æ£€æµ‹ä¸­... å·²æ‰¾åˆ° ' + foundImages.length + ' å¼ ';
                                }
                                
                                // ç»§ç»­æ£€æµ‹ä¸‹ä¸€å¼ 
                                setTimeout(function() { checkNext(index + 1); }, 50);
                            } else {
                                consecutiveFailures++;
                                
                                if (consecutiveFailures >= maxConsecutiveFailures) {
                                    // è¿ç»­å¤±è´¥æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œåœæ­¢æ£€æµ‹
                                    console.log('è¿ç»­ ' + maxConsecutiveFailures + ' æ¬¡æ£€æµ‹å¤±è´¥ï¼Œåœæ­¢æ£€æµ‹');
                                    resolve(foundImages);
                                } else {
                                    // ç»§ç»­æ£€æµ‹ä¸‹ä¸€å¼ 
                                    setTimeout(function() { checkNext(index + 1); }, 50);
                                }
                            }
                        });
                    }
                    
                    checkNext(startIndex);
                });
            }

            // æ£€æµ‹å•ä¸ªå›¾ç‰‡æ˜¯å¦å­˜åœ¨
            checkImageExists(url, index) {
                return new Promise(function(resolve) {
                    var img = new Image();
                    var resolved = false;
                    
                    function resolveOnce(result) {
                        if (!resolved) {
                            resolved = true;
                            resolve(result);
                        }
                    }
                    
                    img.onload = function() {
                        console.log('å›¾ç‰‡å­˜åœ¨: ' + index + '.jpg');
                        resolveOnce({ exists: true, url: url, index: index });
                    };
                    
                    img.onerror = function(e) {
                        console.log('å›¾ç‰‡ä¸å­˜åœ¨: ' + index + '.jpg', e.type);
                        resolveOnce({ exists: false, url: url, index: index });
                    };
                    
                    // è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
                    setTimeout(function() {
                        if (!resolved) {
                            console.log('å›¾ç‰‡æ£€æµ‹è¶…æ—¶: ' + index + '.jpg');
                            resolveOnce({ exists: false, url: url, index: index });
                        }
                    }, 3000);
                    
                    // å°è¯•åŠ è½½å›¾ç‰‡
                    try {
                        img.src = url;
                    } catch (e) {
                        console.log('å›¾ç‰‡åŠ è½½å¼‚å¸¸: ' + index + '.jpg', e);
                        resolveOnce({ exists: false, url: url, index: index });
                    }
                });
            }

            // é¢„åŠ è½½å›¾ç‰‡
            preloadImages() {
                var self = this;
                return new Promise(function(resolve) {
                    if (self.images.length === 0) {
                        resolve();
                        return;
                    }

                    // åœ¨é¢„åŠ è½½ä¹‹å‰æ‰“ä¹±å›¾ç‰‡é¡ºåº
                    console.log('æ‰“ä¹±å›¾ç‰‡é¡ºåº...');
                    self.shuffleArray(self.images);
                    console.log('å›¾ç‰‡é¡ºåºå·²æ‰“ä¹±ï¼Œå¼€å§‹é¢„åŠ è½½...');

                    self.images.forEach(function(src, index) {
                        self.loadImageWithRetry(src, 3).then(function() {
                            self.loadedImages++;
                            self.updateLoadingStatus();
                            if (self.loadedImages === self.totalImages) {
                                resolve();
                            }
                        }).catch(function() {
                            console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼ˆå·²é‡è¯•3æ¬¡ï¼‰: ' + src);
                            self.loadedImages++;
                            if (self.loadedImages === self.totalImages) {
                                resolve();
                            }
                        });
                    });
                });
            }

            // å¸¦é‡è¯•æœºåˆ¶çš„å›¾ç‰‡åŠ è½½
            loadImageWithRetry(src, maxRetries) {
                var self = this;
                return new Promise(function(resolve, reject) {
                    var retryCount = 0;
                    
                    function attemptLoad() {
                        var img = new Image();
                        
                        img.onload = function() {
                            console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ: ' + src);
                            resolve(img);
                        };
                        
                        img.onerror = function() {
                            retryCount++;
                            console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥ (å°è¯• ' + retryCount + '/' + maxRetries + '): ' + src);
                            
                            if (retryCount < maxRetries) {
                                // å»¶è¿Ÿé‡è¯•ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
                                setTimeout(attemptLoad, 1000 * retryCount);
                            } else {
                                reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°'));
                            }
                        };
                        
                        // ç›´æ¥ä½¿ç”¨åŸå§‹URLï¼Œé¿å…ç¼“å­˜å’Œè·¨åŸŸé—®é¢˜
                        img.src = src;
                    }
                    
                    attemptLoad();
                });
            }

            updateLoadingStatus() {
                var loadingProgress = document.getElementById('loadingProgress');
                var loadingOverlay = document.getElementById('loadingOverlay');
                
                if (loadingProgress) {
                    loadingProgress.textContent = this.loadedImages + '/' + this.totalImages;
                }
                
                // åŠ è½½å®Œæˆåéšè—åŠ è½½ç•Œé¢
                if (this.loadedImages === this.totalImages) {
                    setTimeout(function() {
                        if (loadingOverlay) {
                            loadingOverlay.style.display = 'none';
                        }
                    }, 500);
                }
            }

            // Fisher-Yates æ´—ç‰Œç®—æ³•ï¼Œç”¨äºæ‰“ä¹±æ•°ç»„é¡ºåº
            shuffleArray(array) {
                console.log('åŸå§‹å›¾ç‰‡é¡ºåºï¼ˆå‰5å¼ ï¼‰:', array.slice(0, 5));
                
                for (var i = array.length - 1; i > 0; i--) {
                    // ç”Ÿæˆ0åˆ°iä¹‹é—´çš„éšæœºç´¢å¼•
                    var j = Math.floor(Math.random() * (i + 1));
                    
                    // äº¤æ¢å…ƒç´ 
                    var temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
                
                console.log('æ‰“ä¹±åé¡ºåºï¼ˆå‰5å¼ ï¼‰:', array.slice(0, 5));
                return array;
            }

            createImages() {
                var mainCarousel = document.getElementById('mainCarousel');
                var backgroundCarousel = document.getElementById('backgroundCarousel');
                var self = this;
                
                // æ£€æŸ¥æ˜¯å¦æœ‰å›¾ç‰‡
                if (this.images.length === 0) {
                    this.showNoImagesMessage();
                    return;
                }
                
                this.images.forEach(function(src, index) {
                    // åˆ›å»ºä¸»è½®æ’­å›¾å›¾ç‰‡
                    var mainImg = document.createElement('img');
                    mainImg.src = src;
                    mainImg.alt = 'å›¾ç‰‡ ' + (index + 1);
                    if (index === 0) mainImg.classList.add('active');
                    mainCarousel.appendChild(mainImg);
                    
                    // åˆ›å»ºèƒŒæ™¯è½®æ’­å›¾å›¾ç‰‡
                    var bgImg = document.createElement('img');
                    bgImg.src = src;
                    bgImg.alt = 'èƒŒæ™¯å›¾ç‰‡ ' + (index + 1);
                    if (index === 0) bgImg.classList.add('active');
                    backgroundCarousel.appendChild(bgImg);
                });
            }

            showNoImagesMessage() {
                var mainCarousel = document.getElementById('mainCarousel');
                var messageDiv = document.createElement('div');
                messageDiv.style.cssText = 
                    'position: absolute;' +
                    'top: 50%;' +
                    'left: 50%;' +
                    'transform: translate(-50%, -50%);' +
                    'color: white;' +
                    'text-align: center;' +
                    'font-size: 24px;' +
                    'background: rgba(0, 0, 0, 0.8);' +
                    'padding: 40px;' +
                    'border-radius: 10px;' +
                    'backdrop-filter: blur(10px);';
                messageDiv.innerHTML = 
                    '<div style="margin-bottom: 20px;">ğŸ“ æœªæ‰¾åˆ°å›¾ç‰‡</div>' +
                    '<div style="font-size: 16px; opacity: 0.8;">' +
                        'è¯·åœ¨ ./static ç›®å½•ä¸‹æ”¾ç½®å›¾ç‰‡æ–‡ä»¶<br>' +
                        'æ”¯æŒæ ¼å¼ï¼šjpg, png, gif, webp' +
                    '</div>';
                mainCarousel.appendChild(messageDiv);
            }

            createIndicators() {
                var indicatorsContainer = document.getElementById('indicators');
                var self = this;
                
                this.images.forEach(function(_, index) {
                    var indicator = document.createElement('div');
                    indicator.classList.add('indicator');
                    if (index === 0) indicator.classList.add('active');
                    indicator.addEventListener('click', function() { 
                        self.goToSlide(index); 
                    });
                    indicatorsContainer.appendChild(indicator);
                });
            }

            bindEvents() {
                // é—´éš”æ§åˆ¶
                var intervalSlider = document.getElementById('intervalSlider');
                var intervalInput = document.getElementById('intervalInput');
                var self = this;
                
                intervalSlider.addEventListener('input', function(e) {
                    self.interval = parseFloat(e.target.value) * 1000;
                    intervalInput.value = e.target.value;
                    self.restartAutoPlay();
                    self.updateStatus();
                });
                
                intervalInput.addEventListener('change', function(e) {
                    var value = Math.max(1, Math.min(10, parseFloat(e.target.value)));
                    self.interval = value * 1000;
                    intervalSlider.value = value;
                    intervalInput.value = value;
                    self.restartAutoPlay();
                    self.updateStatus();
                });

                // æ’­æ”¾æ§åˆ¶
                document.getElementById('playPauseBtn').addEventListener('click', function() {
                    self.togglePlayPause();
                });

                // å¯¼èˆªæŒ‰é’®
                document.getElementById('prevBtn').addEventListener('click', function() {
                    self.prevSlide();
                });
                
                document.getElementById('nextBtn').addEventListener('click', function() {
                    self.nextSlide();
                });

                // å¯¼èˆªç®­å¤´
                document.getElementById('navPrev').addEventListener('click', function() {
                    self.prevSlide();
                });
                
                document.getElementById('navNext').addEventListener('click', function() {
                    self.nextSlide();
                });

                // é”®ç›˜æ§åˆ¶
                document.addEventListener('keydown', function(e) {
                    switch(e.key) {
                        case 'ArrowLeft':
                            self.prevSlide();
                            break;
                        case 'ArrowRight':
                            self.nextSlide();
                            break;
                        case ' ':
                            e.preventDefault();
                            self.togglePlayPause();
                            break;
                    }
                });

                // æ»‘åŠ¨æ‰‹åŠ¿æ”¯æŒ
                this.bindSwipeEvents();
            }

            bindSwipeEvents() {
                var self = this;
                var startX = 0;
                var startY = 0;
                var endX = 0;
                var endY = 0;
                var minSwipeDistance = 50; // æœ€å°æ»‘åŠ¨è·ç¦»
                var maxVerticalDistance = 100; // æœ€å¤§å‚ç›´è·ç¦»ï¼Œé˜²æ­¢å‚ç›´æ»‘åŠ¨è¯¯è§¦å‘
                var carouselContainer = document.querySelector('.carousel-container');

                // è§¦æ‘¸å¼€å§‹
                carouselContainer.addEventListener('touchstart', function(e) {
                    var touch = e.touches[0];
                    startX = touch.clientX;
                    startY = touch.clientY;
                }, { passive: true });

                // è§¦æ‘¸ç»“æŸ
                carouselContainer.addEventListener('touchend', function(e) {
                    var touch = e.changedTouches[0];
                    endX = touch.clientX;
                    endY = touch.clientY;
                    
                    var deltaX = endX - startX;
                    var deltaY = Math.abs(endY - startY);
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„æ°´å¹³æ»‘åŠ¨
                    if (Math.abs(deltaX) > minSwipeDistance && deltaY < maxVerticalDistance) {
                        if (deltaX > 0) {
                            // å‘å³æ»‘åŠ¨ - ä¸Šä¸€å¼ 
                            self.prevSlide();
                        } else {
                            // å‘å·¦æ»‘åŠ¨ - ä¸‹ä¸€å¼ 
                            self.nextSlide();
                        }
                    }
                }, { passive: true });

                // é¼ æ ‡äº‹ä»¶æ”¯æŒï¼ˆæ¡Œé¢ç«¯ï¼‰
                var isMouseDown = false;
                var mouseStartX = 0;
                var mouseStartY = 0;

                carouselContainer.addEventListener('mousedown', function(e) {
                    isMouseDown = true;
                    mouseStartX = e.clientX;
                    mouseStartY = e.clientY;
                    e.preventDefault();
                });

                carouselContainer.addEventListener('mousemove', function(e) {
                    if (isMouseDown) {
                        e.preventDefault();
                    }
                });

                carouselContainer.addEventListener('mouseup', function(e) {
                    if (isMouseDown) {
                        var deltaX = e.clientX - mouseStartX;
                        var deltaY = Math.abs(e.clientY - mouseStartY);
                        
                        // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„æ°´å¹³æ‹–æ‹½
                        if (Math.abs(deltaX) > minSwipeDistance && deltaY < maxVerticalDistance) {
                            if (deltaX > 0) {
                                // å‘å³æ‹–æ‹½ - ä¸Šä¸€å¼ 
                                self.prevSlide();
                            } else {
                                // å‘å·¦æ‹–æ‹½ - ä¸‹ä¸€å¼ 
                                self.nextSlide();
                            }
                        }
                        
                        isMouseDown = false;
                    }
                });

                // é˜²æ­¢æ‹–æ‹½æ—¶ç¦»å¼€å®¹å™¨
                carouselContainer.addEventListener('mouseleave', function() {
                    isMouseDown = false;
                });
            }

            goToSlide(index) {
                // ç§»é™¤å½“å‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('#mainCarousel img').forEach(function(img) {
                    img.classList.remove('active');
                });
                document.querySelectorAll('#backgroundCarousel img').forEach(function(img) {
                    img.classList.remove('active');
                });
                document.querySelectorAll('.indicator').forEach(function(indicator) {
                    indicator.classList.remove('active');
                });

                // è®¾ç½®æ–°çš„æ´»åŠ¨çŠ¶æ€
                this.currentIndex = index;
                document.querySelectorAll('#mainCarousel img')[this.currentIndex].classList.add('active');
                document.querySelectorAll('#backgroundCarousel img')[this.currentIndex].classList.add('active');
                document.querySelectorAll('.indicator')[this.currentIndex].classList.add('active');
                
                this.updateStatus();
            }

            nextSlide() {
                var nextIndex = (this.currentIndex + 1) % this.images.length;
                this.goToSlide(nextIndex);
            }

            prevSlide() {
                var prevIndex = (this.currentIndex - 1 + this.images.length) % this.images.length;
                this.goToSlide(prevIndex);
            }

            startAutoPlay() {
                var self = this;
                if (this.isPlaying) {
                    this.timer = setInterval(function() {
                        self.nextSlide();
                    }, this.interval);
                }
            }

            stopAutoPlay() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
            }

            restartAutoPlay() {
                this.stopAutoPlay();
                this.startAutoPlay();
            }

            togglePlayPause() {
                this.isPlaying = !this.isPlaying;
                
                if (this.isPlaying) {
                    this.startAutoPlay();
                } else {
                    this.stopAutoPlay();
                }
                
                var btn = document.getElementById('playPauseBtn');
                btn.textContent = this.isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
                
                this.updateStatus();
            }

            updateStatus() {
                var status = document.getElementById('status');
                var playStatus = this.isPlaying ? 'æ­£åœ¨æ’­æ”¾' : 'å·²æš‚åœ';
                var currentImage = this.currentIndex + 1;
                var totalImages = this.images.length;
                var intervalSeconds = this.interval / 1000;
                
                status.textContent = playStatus + ' | å›¾ç‰‡: ' + currentImage + '/' + totalImages + ' | é—´éš”: ' + intervalSeconds + 'ç§’';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–è½®æ’­å›¾
        document.addEventListener('DOMContentLoaded', function() {
            new DualCarousel();
        });

        // å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
        document.addEventListener('error', function(e) {
            if (e.target.tagName === 'IMG') {
                console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥: ' + e.target.src);
                // å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®é»˜è®¤å›¾ç‰‡æˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            }
        }, true);
    </script>
</body>
</html>